<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<title>vulpix</title>
	<link rel="stylesheet" href="index.css">
	<script src="jquery-3.2.1.min.js"></script>
	<script src="3dcarousel.js"></script>
	<script type="text/javascript">
		var locale = "SV-sv";
		var sessionToken = null;
		var sessionUserId = null;
		var resourceId = "1";
		var username = "admin";
		var password = "password";
	
		function updateTime(){
			var d = new Date();
			$("#currentTime").text(d.toLocaleTimeString(locale, {hour: "2-digit", minute: "2-digit"}));
			$("#currentDate").text(d.toLocaleDateString(locale, {month: "long", day:"numeric"}));
		};
		
		function updateBookingView(bookingItems){
			var l = [];
			l.push("<div id='perspective'>");
			l.push("	<div id='carousel'>");
			
			for(var i=0; i<bookingItems.length; i++){
				l.push("<figure>");
				l.push("	<span>Name</span>");
				l.push("	<span>TimeStart</span><span>TimeEnd</span>");
				l.push("	<span>TimeStart</span><span>TimeEnd</span>");
				l.push("	<button class='cancelBookingButton'>Cancel Booking</button>");
				l.push("	<button class='extendBookingButton'>Extend Booking</button>");
				l.push("</figure>");
			}
			
			l.push("	</div>");
			l.push("</div>");
			$("#bookingList").html(l.join("\n"));
			$("#carousel").carousel3d();
		}
		
		function fetchToken(){
			return $.ajax({
				method: "POST",
				url: "http://slowbro.azurewebsites.net/Web/Services/index.php/Authentication/Authenticate",
				dataType: "json",
				contentType: "application/json; charset=utf-8",
				data: JSON.stringify({
					username: username,
					password: password
				})
			}).done(function(r) {
				if(r.isAuthenticated){
					sessionToken = r.sessionToken;
					sessionUserId = r.userId;
				}
			});
		}
		
		function fetchResourceData(){
			return $.ajax({
				method: "GET",
				url: "http://slowbro.azurewebsites.net/Web/Services/index.php/Resources/" + resourceId,
				headers: {
					"X-Booked-SessionToken": sessionToken,
					"X-Booked-UserId": sessionUserId
				}
			}).done(function(r) {
				$("#roomName").text(r.name);
			});
		}
		
		function fetchReservationsData(){
			return $.ajax({
				method: "GET",
				url: "http://slowbro.azurewebsites.net/Web/Services/index.php/Reservations",
				dataType: "json",
				data: {
					resourceId: resourceId
				},
				headers: {
					"X-Booked-SessionToken": sessionToken,
					"X-Booked-UserId": sessionUserId
				}
			}).done(function(r) {
				console.log(r);
			});
		}
	
		$(document).ready(function(){
			updateTime();
			updateBookingView([
				{
					id: 1,
					name: "Samsung",
					start: "2017-04:28T08:00",
					end: "2017-04:28T11:00"
				},
				{
					id: 2,
					name: "Epicenter",
					start: "2017-04:28T12:00",
					end: "2017-04:28T13:00"
				},
				{
					id: 3,
					name: "Epicenter",
					start: "2017-04:28T12:00",
					end: "2017-04:28T13:00"
				},
				{
					id: 4,
					name: "Epicenter",
					start: "2017-04:28T12:00",
					end: "2017-04:28T13:00"
				},
				{
					id: 5,
					name: "Epicenter",
					start: "2017-04:28T12:00",
					end: "2017-04:28T13:00"
				}
			]);
			
			fetchToken()
			.then(fetchResourceData)
			.then(fetchReservationsData);
			
			//$("#debugString").text("w:" + window.innerWidth + " h:" + window.innerHeight);
			setInterval(function(){
				updateTime();
				fetchReservationsData()
				.fail(fetchToken)
				.then(fetchReservationsData);
			}, 1000 * 60);
		});
	</script>
</head>
<body class="rootContainer">

<h1 style="text-align:center" id="debugString"></h1>

<div class="container1">
	<div class="innerContainer">
		<span id="currentTime">currentTime</span>
		<span id="currentDate">currentDate</span>
	</div>
</div>

<div class="container2">
	<div class="innerContainer">
		<img id="imageLogo" src="symbio_logo.svg"></img>
		<span id="roomName">roomName</span>
		<button id="addBookingButton" class="addBookingButton">Add Booking</button>
	</div>
</div>

<div style="clear:both"></div>

<div class="container3">
	<div id="bookingList">
	</div>
</div>

</body>
</html>
